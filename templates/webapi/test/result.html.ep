% layout 'bootstrap';
% title $job->name . " test results";

% content_for 'head' => begin
%= asset 'test_result.js'
% end

% content_for 'ready_function' => begin
    $('.timeago').timeago();
    setupResultButtons();
    setupResult('<%= $job->state %>', <%= $job->id %>, '<%= url_for('status', testid => $job->id) %>', '<%= url_for('module_components', testid => $job->id) %>');
% end

<div class="row">
    <div class="col-sm-12">
        %= include 'layouts/info'
    </div>
</div>

<div class="row" id="result-row">
    <div class="col-sm-12">
        %= include 'test/infopanel', worker => $assigned_worker
        <div role="tabpanel">
            <ul class="nav nav-tabs" role="tablist" id="result_tabs">
                <li role="presentation" class="nav-item">
                    <a href="#details" aria-controls="details" role="tab" data-toggle="tab" class="nav-link active">Details</a>
                </li>
                <!--% if ($has_parser_text_results) {-->
                <!-- TODO maybe we can move "has_parser_text_results into the
                    sub-route and evaluate if modules had been loaded in there
                -->
                    <li role="presentation" class="nav-item">
                        <a href="#external" aria-controls="external" role="tab" data-toggle="tab" class="nav-link">External results</a>
                    </li>
                <!--% }-->
                % if ($job->state eq 'running') {
                    <li role="presentation" class="nav-item">
                        <a href="#live" aria-controls="live" role="tab" data-toggle="tab" class="nav-link">Live View</a>
                    </li>
                % }
                <li role="presentation" class="nav-item">
                    <a href="#downloads" aria-controls="downloads" role="tab" data-toggle="tab" class="nav-link">Logs &amp; Assets</a>
                </li>
                <li role="presentation" class="nav-item">
                    <a href="#settings" aria-controls="settings" role="tab" data-toggle="tab" class="nav-link">Settings</a>
                </li>
                % if ($show_dependencies) {
                    <li role="presentation" class="nav-item">
                        <a href="#dependencies" aria-controls="dependencies" role="tab" data-toggle="tab" class="nav-link">Dependencies</a>
                    </li>
                % }
                % if ($job->result eq OpenQA::Jobs::Constants::FAILED) {
                    <li role="presentation" class="nav-item">
                        <a href="#investigation" aria-controls="investigation" role="tab" data-toggle="tab" class="nav-link">Investigation</a>
                    </li>
                % }
                <li role="presentation" class="nav-item">
                    <a href="#comments" aria-controls="comments" role="tab" data-toggle="tab" class="nav-link">Comments (<%= scalar($job->comments) %>)</a>
                </li>
                <li role="presentation" class="nav-item">
                    <a href="#next_previous" aria-controls="next_previous" role="tab" data-toggle="tab" class="nav-link">Next &amp; previous results</a>
                </li>
            </ul>

            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="details">
                    %= include 'test/details'
                </div>
                <div role="tabpanel" class="tab-pane" id="external">
                    %= include 'test/external'
                </div>

                % if ($job->state eq 'running') {
                    <div role="tabpanel" class="tab-pane" id="live">
                        %= include 'test/live'
                    </div>
                % }

                <div role="tabpanel" class="tab-pane" id="downloads">
                    %= include 'test/downloads'
                </div>

                <div role="tabpanel" class="tab-pane" id="settings">
                    %= include 'test/settings'
                </div>
                % if ($show_dependencies) {
                    <div role="tabpanel" class="tab-pane" id="dependencies">
                        %= include 'test/dependencies'
                    </div>
                % }
                % if ($job->result eq OpenQA::Jobs::Constants::FAILED) {
                    <div role="tabpanel" class="tab-pane" id="investigation">
                        <div class="investigation">
                            %= include 'test/investigation'
                        </div>
                    </div>
                % }
                <div role="tabpanel" class="tab-pane" id="comments">
                    <div class="comments">
                        %= include 'test/comments'
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="next_previous">
                    <div class="next_previous">
                        %= include 'test/job_next_previous'
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="preview_container_out">
    <div id="preview_container_in" class="well well-lg">
    </div>
</div>
