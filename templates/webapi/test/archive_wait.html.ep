% layout 'default';
% title 'Preparing Archive - ' . $job->id;

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <h3>Preparing Archive for Job <%= $job->id %></h3>
            <p class="lead">Please wait while the ZIP archive is being created. This might take a while for large jobs.</p>
            <div class="spinner-border text-primary my-4" role="status">
                <span class="sr-only">Loadingâ€¦</span>
            </div>
            <p>You will be automatically redirected once the download is ready.</p>
        </div>
    </div>
</div>

<script>
    function checkStatus() {
        fetch(window.location.href, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        }).then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                setTimeout(checkStatus, 5000);
            }
        }).catch(() => {
            setTimeout(checkStatus, 5000);
        });
    }
    setTimeout(checkStatus, 5000);
</script>
